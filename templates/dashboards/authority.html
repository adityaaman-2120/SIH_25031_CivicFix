{% extends 'base.html' %}
{% load static %}
{% block title %}Authority Dashboard - CivicFix{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/authority.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<h2 class="mb-3">Authority Dashboard</h2>

<!-- Background Animation -->
    <div class="background-animation">
        <div class="floating-shapes">
            <div class="shape shape-1"></div>
            <div class="shape shape-2"></div>
            <div class="shape shape-3"></div>
            <div class="shape shape-4"></div>
        </div>
    </div>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="currentColor"/>
                    <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" fill="none"/>
                    <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
                <span class="logo-text">CivicFix Authority</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 12H21M3 6H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>

        <div class="sidebar-menu">
            <a href="#" class="nav-link active" data-section="assigned">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Assigned Complaints</span>
            </a>
            <a href="#" class="nav-link" data-section="analytics">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 3V21H21M7 14L12 9L16 13L21 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Analytics</span>
            </a>
            <a href="#" class="nav-link" data-section="team">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21M23 21V19C22.9993 18.1137 22.7044 17.2528 22.1614 16.5523C21.6184 15.8519 20.8581 15.3516 20 15.13M16 3.13C16.8604 3.35031 17.623 3.85071 18.1676 4.55232C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89317 18.7122 8.75608 18.1676 9.45768C17.623 10.1593 16.8604 10.6597 16 10.88M13 7C13 9.20914 11.2091 11 9 11C6.79086 11 5 9.20914 5 7C5 4.79086 6.79086 3 9 3C11.2091 3 13 4.79086 13 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Team Management</span>
            </a>
        </div>

        <div class="sidebar-footer">
            <a href="index.html" class="nav-link logout">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9M16 17L21 12M21 12L16 7M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Logout</span>
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1 class="page-title">Authority Dashboard</h1>
                <p class="page-subtitle">Manage and resolve citizen complaints efficiently</p>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <div class="user-avatar">
                        <span>JD</span>
                    </div>
                    <div class="user-details">
                        <div class="welcome-text">
                        <h1 class="display-6 mb-2">Hello, {{ request.user.first_name|default:request.user.username }}</h1>
                            <p>Welcome back to your CivicFix dashboard</p>
                        </div>
                        <span class="user-role">Senior Authority</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Assigned Complaints Section -->
        <section class="content-section active" id="assigned-section">
            <div class="section-header">
                <h2>Assigned Complaints</h2>
                <div class="section-actions">
                    <select id="priorityFilter" class="filter-select">
                        <option value="all">All Priorities</option>
                        <option value="high">High Priority</option>
                        <option value="medium">Medium Priority</option>
                        <option value="low">Low Priority</option>
                    </select>
                    <select id="statusFilter" class="filter-select">
                        <option value="all">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="progress">In Progress</option>
                        <option value="resolved">Resolved</option>
                    </select>
                </div>
            </div>
            <div class="complaints-grid" id="assignedComplaintsGrid">
                <!-- Dynamic content will be loaded here -->
            </div>
            
            <!-- Sample complaint cards for demonstration -->
            <div class="complaint-card fade-in">
                <div class="complaint-header">
                    <div class="complaint-info">
                        <h3>Pothole near Sector 5 Road</h3>
                        <div class="complaint-location">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                                <path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22S19 14.25 19 9C19 5.13 15.87 2 12 2Z" fill="currentColor"/>
                            </svg>
                            Salt Lake, Kolkata
                        </div>
                    </div>
                    <div class="complaint-priority priority-high">HIGH</div>
                </div>
                
                <div class="complaint-meta">
                    <div class="complaint-category">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="currentColor"/>
                        </svg>
                        Roads
                    </div>
                    <div class="complaint-date">Aug 12, 2024</div>
                    <div class="complaint-id">CF-101</div>
                </div>
                
                <div class="complaint-status status-pending">PENDING</div>
                
                <p class="complaint-description">Large pothole causing vehicle damage and traffic disruption. Immediate repair needed for safety.</p>
                
                <div class="complaint-actions">
                    <button class="action-btn primary">Start Progress</button>
                    <button class="action-btn secondary">View Details</button>
                </div>
            </div>
        </section>

        <!-- Analytics Section -->
        <section class="content-section" id="analytics-section">
            <div class="section-header">
                <h2>Analytics & Reports</h2>
                <div class="section-actions">
                    <button class="action-btn secondary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15M7 10L12 15L17 10M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Export Report
                    </button>
                </div>
            </div>
            
            <div class="analytics-grid">
                <div class="analytics-card">
                    <h3>Complaint Statistics</h3>
                    <div class="chart-container">
                        <canvas id="complaintsChart" width="400" height="200"></canvas>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3>Category Distribution</h3>
                    <div class="chart-container">
                        <canvas id="categoryChart" width="400" height="200"></canvas>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3>Resolution Timeline</h3>
                    <div class="chart-container">
                        <canvas id="timelineChart" width="400" height="200"></canvas>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3>Performance Metrics</h3>
                    <div class="metrics-grid">
                        <div class="metric-item">
                            <div class="metric-value" id="avgResolutionTime">0</div>
                            <div class="metric-label">Avg Resolution Time (days)</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value" id="resolutionRate">0%</div>
                            <div class="metric-label">Resolution Rate</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value" id="citizenSatisfaction">0%</div>
                            <div class="metric-label">Citizen Satisfaction</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Team Management Section -->
        <section class="content-section" id="team-section">
            <div class="section-header">
                <h2>Team Management</h2>
                <div class="section-actions">
                    <button class="action-btn primary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M16 21V19C16 17.9391 15.5786 16.9217 14.8284 16.1716C14.0783 15.4214 13.0609 15 12 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21M20 8V14M23 11H17M12.5 7C12.5 9.20914 10.7091 11 8.5 11C6.29086 11 4.5 9.20914 4.5 7C4.5 4.79086 6.29086 3 8.5 3C10.7091 3 12.5 4.79086 12.5 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Add Team Member
                    </button>
                </div>
            </div>
            <div class="team-grid" id="teamGrid">
                <!-- Dynamic content will be loaded here -->
            </div>
        </section>
    </main>

    <!-- Modal for Complaint Details -->
    <div class="modal-overlay" id="complaintModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Complaint Details</h3>
                <button class="modal-close" onclick="closeModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Dynamic content -->
            </div>
            <div class="modal-footer">
                <button class="action-btn secondary" onclick="closeModal()">Close</button>
                <button class="action-btn primary" id="modalActionBtn">Update Status</button>
            </div>
        </div>
    </div>

  {% block extra_js %}
  <script src="{% static 'js/authority.js' %}"></script>
  {% endblock %}
{% endblock %}